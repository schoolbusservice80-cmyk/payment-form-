<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‹¨áŠ­áá‹« áˆ›áˆ¨áŒ‹áŒˆáŒ« ááˆ­áˆ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; padding: 20px; }
        .form-container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        h2 { color: #2c3e50; text-align: center; margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #34495e; }
        input, select { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background-color: #27ae60; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; transition: 0.3s; }
        button:hover { background-color: #219150; }
        #status { text-align: center; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="form-container">
    <h2>á‹¨áŠ­áá‹« áˆ›áˆ¨áŒ‹áŒˆáŒ«</h2>
    <form id="paymentForm">
        <label>á‹¨á‰°áˆ›áˆª áˆ™áˆ‰ áˆµáˆ</label>
        <input type="text" id="studentName" placeholder="áˆµáˆ á‹«áˆµáŒˆá‰¡" required>

        <label>áˆµáˆáŠ­ á‰áŒ¥áˆ­</label>
        <input type="tel" id="phoneNumber" placeholder="09..." required>

        <label>á‰µáˆáˆ…áˆ­á‰µ á‰¤á‰µ</label>
        <select id="schoolName" required>
            <option value="">á‰µáˆáˆ…áˆ­á‰µ á‰¤á‰µ á‹­áˆáˆ¨áŒ¡</option>
            <option value="Mald School">Mald School</option>
            <option value="Other">Other</option>
        </select>

        <label>á‹¨áˆ°áˆ«á‰°áŠ› áˆµáˆ</label>
        <input type="text" id="staffName" value="á‹ˆ/áˆ® áŒˆáŠá‰µ" readonly>

        <label>á‹¨á‰£áŠ•áŠ­ á‹°áˆ¨áˆ°áŠ (áá‰¶)</label>
        <input type="file" id="receiptFile" accept="image/*" required>

        <button type="submit" id="submitBtn">áˆ˜áˆ¨áŒƒá‹áŠ• áˆ‹áŠ­</button>
    </form>
    <div id="status"></div>
</div>

<script>
    // Firebase Config (á‹¨áŠ áŠ•á‰° áˆ˜áˆ¨áŒƒ)
    const firebaseConfig = {
        databaseURL: "https://school-bus-service-80-cmyk-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const BOT_TOKEN = '8426304366:AAG--hBWYucN4RjgkfHi8YzB3z61vxwMeis';
    const CHAT_ID = '8333746172';

    document.getElementById('paymentForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const status = document.getElementById('status');
        
        btn.disabled = true;
        btn.innerText = "áŠ¥á‹¨áˆ‹áŠ¨ áŠá‹...";

        const name = document.getElementById('studentName').value;
        const phone = document.getElementById('phoneNumber').value;
        const school = document.getElementById('schoolName').value;
        const staff = document.getElementById('staffName').value;
        const fileInput = document.getElementById('receiptFile');
        const file = fileInput.files[0];

        try {
            // 1. áˆ˜áŒ€áˆ˜áˆªá‹« á‹ˆá‹° Firebase áˆ˜áˆ‹áŠ­
            await database.ref('payments/').push({
                studentName: name,
                phone: phone,
                school: school,
                staff: staff,
                status: "Pending",
                date: new Date().toLocaleString()
            });

            // 2. á‹ˆá‹° á‰´áˆŒáŒáˆ«áˆ áˆ˜áˆ‹áŠ­
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', file);
            formData.append('caption', `ğŸ“© áŠ á‹²áˆµ á‹¨áŠ­áá‹« áˆ˜áˆ¨áŒƒ\n\nğŸ‘¤ áˆµáˆ: ${name}\nğŸ“ áˆµáˆáŠ­: ${phone}\nğŸ« á‰µáˆáˆ…áˆ­á‰µ á‰¤á‰µ: ${school}\nğŸ‘©â€ğŸ’¼ áˆ°áˆ«á‰°áŠ›: ${staff}`);

            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                status.style.color = "green";
                status.innerText = "á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áˆáŠ³áˆ! áŠ¥áŠ“áˆ˜áˆ°áŒáŠ“áˆˆáŠ•á¢";
                document.getElementById('paymentForm').reset();
            } else {
                throw new Error("Telegram error");
            }
        } catch (error) {
            status.style.color = "red";
            status.innerText = "áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆá£ áŠ¥á‰£áŠ­á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢";
        } finally {
            btn.disabled = false;
            btn.innerText = "áˆ˜áˆ¨áŒƒá‹áŠ• áˆ‹áŠ­";
        }
    });
</script>

</body>
</html>

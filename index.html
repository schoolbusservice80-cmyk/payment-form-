<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‹¨áŠ­áá‹« áˆ›áˆ¨áŒ‹áŒˆáŒ« ááˆ­áˆ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; padding: 20px; }
        .form-container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        h2 { color: #2c3e50; text-align: center; font-size: 20px; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #34495e; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        button { width: 100%; padding: 15px; background-color: #27ae60; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin-top: 25px; font-weight: bold; }
        button:disabled { background-color: #bdc3c7; }
        #status { text-align: center; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="form-container">
    <h2>á‹¨áˆ›áˆá‹µ á‰µáˆ«áŠ•áˆµá–áˆ­á‰µ áŠ­áá‹« áˆ›áˆ¨áŒ‹áŒˆáŒ«</h2>
    <form id="paymentForm">
        <label>á‹¨á‰°áˆ›áˆª áˆ™áˆ‰ áˆµáˆ</label>
        <input type="text" id="studentName" placeholder="áˆµáˆ á‹«áˆµáŒˆá‰¡" required>

        <label>áˆµáˆáŠ­ á‰áŒ¥áˆ­</label>
        <input type="tel" id="phoneNumber" placeholder="09..." required>

        <label>á‰µáˆáˆ…áˆ­á‰µ á‰¤á‰µ á‹­áˆáˆ¨áŒ¡</label>
        <select id="schoolName" onchange="updateStaffList()" required>
            <option value="">-- á‰µáˆáˆ…áˆ­á‰µ á‰¤á‰µ á‹­áˆáˆ¨áŒ¡ --</option>
            <option value="MALD INTERNATIONAL SCHOOLS">MALD INTERNATIONAL SCHOOLS</option>
            <option value="BIS INTERNATIONAL SCHOOL">BIS INTERNATIONAL SCHOOL</option>
        </select>

        <label>á‹¨áˆ°áˆ«á‰°áŠ› áˆµáˆ</label>
        <select id="staffName" required disabled>
            <option value="">-- áˆ˜áŒ€áˆ˜áˆªá‹« á‰µáˆáˆ…áˆ­á‰µ á‰¤á‰µ á‹­áˆáˆ¨áŒ¡ --</option>
        </select>

        <label>á‹¨á‰£áŠ•áŠ­ á‹°áˆ¨áˆ°áŠ (áá‰¶)</label>
        <input type="file" id="receiptFile" accept="image/*" required>

        <button type="submit" id="submitBtn">áˆ˜áˆ¨áŒƒá‹áŠ• áˆ‹áŠ­</button>
    </form>
    <div id="status"></div>
</div>

<script>
    // áˆ°áˆ«á‰°áŠá‰½áŠ• áŠ¨á‰µáˆáˆ…áˆ­á‰µ á‰¤á‰µ áŒ‹áˆ­ áˆ›á‹«á‹«á‹
    const staffData = {
        "MALD INTERNATIONAL SCHOOLS": ["á‹ˆ/áˆ® áŒˆáŠá‰µ", "á‹ˆ/áˆ® á‚á‹®áŠ•", "á‹ˆ/áˆ® áˆ°áˆ‹áˆ", "áŠ /á‰¶ áŠ¤áˆ­áˆá‹«áˆµ", "áŠ /á‰¶ á‹³áŠ•áŠ¤áˆ"],
        "BIS INTERNATIONAL SCHOOL": ["á‹ˆ/áˆ® á‰µáˆ…á‰µáŠ“", "á‹ˆ/áˆ® áŠ á‰ á‰ á‰½", "á‹ˆ/áˆ® á‰µáŠ¥áŒáˆµá‰µ", "á‹ˆ/áˆ® áˆ³áˆ«", "áŠ /á‰¶ áŠ á‰¥á‹°áˆ‹", "áŠ /á‰¶ á‰¶áŠá‰…", "áŠ /á‰¶ áˆ˜á‰¥áˆ«áˆ…á‰±"]
    };

    function updateStaffList() {
        const schoolSelect = document.getElementById("schoolName");
        const staffSelect = document.getElementById("staffName");
        const selectedSchool = schoolSelect.value;

        staffSelect.innerHTML = '<option value="">-- áˆ°áˆ«á‰°áŠ› á‹­áˆáˆ¨áŒ¡ --</option>';

        if (selectedSchool && staffData[selectedSchool]) {
            staffSelect.disabled = false;
            staffData[selectedSchool].forEach(staff => {
                const option = document.createElement("option");
                option.value = staff;
                option.text = staff;
                staffSelect.appendChild(option);
            });
        } else {
            staffSelect.disabled = true;
        }
    }

    const firebaseConfig = { databaseURL: "https://school-bus-service-80-cmyk-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const BOT_TOKEN = '8426304366:AAG--hBWYucN4RjgkfHi8YzB3z61vxwMeis';
    const CHAT_ID = '8333746172';

    document.getElementById('paymentForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const status = document.getElementById('status');
        
        btn.disabled = true;
        status.innerText = "áˆ˜áˆ¨áŒƒá‹ áŠ¥á‹¨á‰°áˆ‹áŠ¨ áŠá‹...";
        status.style.color = "blue";

        const fileInput = document.getElementById('receiptFile');
        const file = fileInput.files[0];

        const formData = new FormData();
        formData.append('chat_id', CHAT_ID);
        formData.append('photo', file);
        formData.append('caption', `ğŸ“© áŠ á‹²áˆµ á‹¨áŠ­áá‹« áˆ˜áˆ¨áŒƒ\n\nğŸ‘¤ áˆµáˆ: ${document.getElementById('studentName').value}\nğŸ“ áˆµáˆáŠ­: ${document.getElementById('phoneNumber').value}\nğŸ« á‰µ/á‰¤á‰µ: ${document.getElementById('schoolName').value}\nğŸ‘©â€ğŸ’¼ áˆ°áˆ«á‰°áŠ›: ${document.getElementById('staffName').value}`);

        try {
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                await database.ref('payments/').push({
                    studentName: document.getElementById('studentName').value,
                    phone: document.getElementById('phoneNumber').value,
                    school: document.getElementById('schoolName').value,
                    staff: document.getElementById('staffName').value,
                    date: new Date().toLocaleString()
                });

                status.style.color = "green";
                status.innerText = "á‰°áˆ³áŠ­á‰·áˆ! áˆ˜áˆ¨áŒƒá‹ á‰°áˆáŠ³áˆá¢";
                document.getElementById('paymentForm').reset();
                document.getElementById("staffName").disabled = true;
            } else {
                status.innerText = "áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆ (á‰¦á‰±áŠ• Start áˆ›áˆˆá‰³á‰½áˆáŠ• áŠ áˆ¨áŒ‹áŒáŒ¡)";
                status.style.color = "red";
            }
        } catch (error) {
            status.innerText = "á‹¨áŠ”á‰µá‹ˆáˆ­áŠ­ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆ!";
            status.style.color = "red";
        } finally {
            btn.disabled = false;
        }
    });
</script>

</body>
</html>
